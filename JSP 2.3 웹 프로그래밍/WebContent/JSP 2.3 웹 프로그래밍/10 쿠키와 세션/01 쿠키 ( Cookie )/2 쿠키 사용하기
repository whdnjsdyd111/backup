JSP에서 쿠키를 사용하려면 javax.servlet.http 패키지에 있는 Cookie 클래스의 객체를 생성해야 한다. 이렇게 생성된 쿠키에는 각 웹 브라우저를 판별할 수 있는 정보가
포함되어 있다. 생성된 쿠키는 웹 서버가 웹 브라우저의 요청에 응답할 때 response 객체에 실려서 사용자의 웹 브라우저에 저장된다. 웹 브라우저에 저장된 쿠키는 다시 사용자가 웹 서버에 요청할 때
request 객체에 실려서 웹 서버에 전달된다. 이때 웹 서버는 전달된 쿠키의 값을 읽어서 같은 웹 브라우저로부터 온 요청인지를 판별하게 된다. 이러한 방법에 의해 웹 서버는 각각의 웹 브라우저와의 상태를 지속시킬 수 있다.

(1) 쿠키 생성 및 사용

쿠키는 이름, 값, 유효기간, 도메인, 경로 등의 요소로 이루어져 있는데, 이 중 쿠키의 이름과 값이 가장 중요하다. 쿠키를 식별하는 데 사용되는 것이 이름이고, 원하는 작업을 수행하려면 해당 쿠키에 대한 값이 있어야 하기 때문이다.
쿠키의 이름은 알파벳과 숫자로만 구성되고 $로는 시작할 수 없다. 쿠키 값은 공백, 괄호, 등호, 콤마, 세미콜론을 포함할 수 없는데, 이들 값을 포함하려면 인코딩을 해주어야 한다.
JSP에서 쿠키를 생성하려면 다음과 같이 Cookie 클래스를 사용한다. Cookie 클래스를 사용한 쿠키의 생성은 다음과 같다.

Cookie cookie = new Cookie(String name, String value);

Cookie 클래스의 생성자는 String 타입의 매개 변수 두 개를 가지고 있다. 첫 번째 매개 변수 name은 생성되어지는 쿠키의 이름을 설정하고, 두 번째 매개 변수인 values는 이 쿠키에 해당하는 값을 설정한다.
쿠키를 생성한 후에는 반드시 response 객체의 addCookie() 메소드를 사용해서 쿠키를 추가해 주어야 한다. 그래야 생성된 쿠키가 response 객체에 실려서 웹 브라우저에 응답 시 브라우저에 저장된다.

response.addCookie(cookie);

// 예시
Cookie cookie = new Cookie(id, "kingdora");
response.addCookie(cookie);

쿠키 생성 후 쿠키의 값을 새 값으로 변경할 때는 setValue() 메소드를 사용한다.

cookie.setValue(new Value);

즉, cookie라는 이름을 가진 쿠키 객체를 생성한 후 값을 새롭게 지정하기 위해서 사용된다.
이 메소드가 수행되면 초기에 생성된 쿠키의 값은 새로 지정된 값으로 변경된다.

Cookie cookie = new Cookie(id, "kingdora");
cookie.setValue("miming");

웹 브라우저의 요청과 함께 request 객체에 실려 온 쿠키를 읽어 올 때는 request 객체의 getCookie() 메소드를  사용한다. 즉, getCookies() 메소드를 사용해서 웹 브라우저에 저장된 쿠키를 읽어 온다.

Cookie[] cookies = request.getCookies();

getCookies() 메소드는 웹 브라우저에 저장된 쿠키를 모두 읽어오기 때문에 리턴 타입이 Cookie[]이다.
쿠키의 수명(지속 시간)은 cookie 객체의 setMaxAge() 메소드를 사용해서 지정한다.

cookie.setMaxAge(int expiry)

매개 변수 expiry는 초 단위로 쿠키의 최대 수명을 설정한다. 쿠키가 생성된 후에 setMaxAge() 메소드에서 설정한 시간만큼만 쿠키가 유효하게 된다.
이 시간을 초과한 쿠키는 사용기간이 만료된 것으로 분류되며, 더 이상 사용되지 않는다. 예를 들어, 쿠키의 수명을 일주일로 설정하려면 cookie.setMaxAge(7 * 24 * 60 * 60); 로 설정하면 된다.

(2) 쿠키 작성

1) 쿠키 작성 순서

1	먼저 쿠키를 생성한다.

2	쿠키에 필요한 설정을 한다. 쿠키의 유효 시간, 쿠키에 대한 설명 등을 적용하고 도메인, 패스, 보안 등을 설정한다.

3	웹 브라우저에 생성된 쿠키를 전송한다.

2) 웹 브라우저에 저장된 쿠키를 사용하는 순서

1	웹 브라우저에 요청에서 쿠키를 얻어온다.

2	쿠키는 이름, 값의 쌍으로 된 배열 형태로 리턴된다. 리턴된 쿠키의 배열에서 쿠키 이름을 가져온다.

3	쿠키 이름을 통해서 해당 쿠키에 설정된 값을 추출한다.


이 예제는 Cookie 객체를 사용해서 쿠키를 생성하고 사용하는 예제이다. 쿠키를 생성하는 역할은 makeCookie.jsp 페이지에서 수행하고, 생성된 쿠키를 사용하는 역할은 useCookie.jsp 페이지에서 수행한다.

makeCookie.jsp		394쪽

useCookie.jsp		395쪽